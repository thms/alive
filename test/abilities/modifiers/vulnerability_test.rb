require 'test_helper'

class VulnerabilityTest < ActiveSupport::TestCase

  test "Vulnerable should increase the damage taken " do
    attacker = Dinosaur.new(damage_26: 500, level: 26, speed: 130, name: 'attacker', abilities: []).reset_attributes!
    defender = Dinosaur.new(health_26: 1000, level: 26, speed: 125, name: 'defender', abilities: []).reset_attributes!
    defender.add_modifier(Modifiers::Vulnerability.new(1, 1))
    Strike.new.execute(attacker, defender)
    assert_equal 1000 - 500 * 1.25, defender.current_health
  end

  test "100% resistance to vulnerable should not increase the damage taken " do
    attacker = Dinosaur.new(damage_26: 500, level: 26, speed: 130, name: 'attacker', abilities: []).reset_attributes!
    defender = Dinosaur.new(health_26: 1000, level: 26, speed: 125, name: 'defender', abilities: [], resistances: [0,0,0,0,0,0,0,0,100]).reset_attributes!
    defender.add_modifier(Modifiers::Vulnerability.new(1, 1))
    Strike.new.execute(attacker, defender)
    assert_equal 500, defender.current_health
  end

  test "40% esistance to vulnerable should increase the damage taken less " do
    attacker = Dinosaur.new(damage_26: 500, level: 26, speed: 130, name: 'attacker', abilities: []).reset_attributes!
    defender = Dinosaur.new(health_26: 1000, level: 26, speed: 125, name: 'defender', abilities: [], resistances: [0,0,0,0,0,0,0,0,40]).reset_attributes!
    defender.add_modifier(Modifiers::Vulnerability.new(1, 1))
    Strike.new.execute(attacker, defender)
    assert_equal 1000 - 500 * (1 + 0.25 * 0.6), defender.current_health
  end
  
end
